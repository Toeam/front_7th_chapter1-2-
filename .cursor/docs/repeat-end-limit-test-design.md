# 반복 종료 조건(날짜 지정 + 최대 2025-12-31 제한) - 테스트 설계

## 목적
반복 일정의 종료 조건(특정 날짜)과 시스템 최대 종료일(2025-12-31) 상한이 정확히 반영되는지 검증한다. 기존 반복 규칙(31일/윤년)은 유지되어야 한다.

## 범위
- 유틸: `src/utils/eventUtils.ts#getFilteredEvents` 반복 확장 결과 검증
- 통합: `src/App.tsx` 플로우(생성 → 리스트/뷰 반영)에서 상한 적용 여부 확인
- 폼 검증: "반복 일정" 체크 상태에서 반복 유형 미선택 제출 시 오류 표시 검증

## 전략
- 패턴: AAA(단위) + Given-When-Then(통합)
- 단위 우선, 통합은 핵심 사용자 시나리오 최소화
- 타이머/시스템 시각은 필요한 경우 `vi.setSystemTime`

## 단위 테스트 케이스 (eventUtils)
1) 종료일 지정: 종료일 포함, 이후 미포함
- Given: 시작일 `2025-01-31`, `repeat: { type: 'monthly', interval: 1, endDate: '2025-03-31' }`
- When: 2025-03 월 뷰, 2025-04 월 뷰 확장
- Then: 2025-03-31 포함, 2025-04 범위 미포함

2) 종료일 미지정: 시스템 최대 종료일 2025-12-31까지만 표시
- Given: 시작일 `2025-10-01`(수), `repeat: { type: 'weekly', interval: 1 }`
- When: 2025-12 주/월 뷰, 2026-01 주/월 뷰 확장
- Then: 2025-12-31까지 포함, 2026-01은 미포함

3) 경계 포함: 발생일이 정확히 2025-12-31인 경우 포함됨
- Given: 시작일 `2025-10-31`, `repeat: { type: 'monthly', interval: 2 }`
- When: 2025-12 월 뷰 확장
- Then: 2025-12-31 발생 시 포함

4) 매월 31일 규칙 유지 + 상한 동작
- Given: 시작일 `2025-01-31`, `repeat: { type: 'monthly', interval: 1 }`
- When: 2025-02/03/04/12 월 뷰 확장
- Then: 2월/4월 등 31일 없는 달 미포함, 3월/12월 31일 포함, 단 2025-12 이후 미포함

5) 윤년 2/29 규칙 유지 + 상한 동작
- Given: 시작일 `2024-02-29`, `repeat: { type: 'yearly', interval: 1 }`
- When: 2025-02, 2028-02 월 뷰 확장
- Then: 2025-02 미포함, 2028-02-29는 시스템 한계(2025-12-31) 초과로 미포함

6) 단일 일정 회귀
- Given: `repeat.type = 'none'`
- Then: 기존 필터 동작과 동일

## 통합 테스트 케이스 (App)
7) 종료일 미지정 반복 저장 → 2026년 달력에서는 인스턴스 미표시
- Given: 반복 일정 생성(주 반복, 종료일 미지정)
- When: 2026-01로 달력 이동
- Then: 해당 반복 인스턴스가 렌더링되지 않음

8) 종료일 지정 반복 저장 → 종료월까지 표시, 다음 달 미표시
- Given: 반복 일정 생성(월 반복, 종료일 2025-03-31)
- When: 2025-03, 2025-04로 달력 이동
- Then: 3월은 표시, 4월은 미표시

9) 폼 검증(생성): "반복 일정" 체크 + 반복 유형 미선택 상태에서 제출 시 오류
- Given: 새 일정 생성 폼에서 "반복 일정" 체크만 활성화(유형 미선택)
- When: "일정 추가" 버튼 클릭
- Then: 오류 메시지 `반복 유형을 선택해주세요`가 표시되고 저장되지 않음

10) 폼 검증(수정): 기존 일정 수정 화면에서 "반복 일정" 체크 + 유형 미선택 상태로 저장 시 오류
- Given: 기존 일정 편집 폼에서 "반복 일정" 체크(유형 미선택)
- When: "일정 수정" 버튼 클릭
- Then: 오류 메시지 `반복 유형을 선택해주세요`가 표시되고 저장되지 않음

## 체크리스트
- [ ] 종료일 지정 시 포함/배제 규칙 검증
- [ ] 종료일 미지정 시 2025-12-31 상한 적용 검증
- [ ] 경계일(2025-12-31) 포함성 검증
- [ ] 31일/윤년 규칙 유지 검증
- [ ] 통합 플로우에서 상한 적용 확인

## 메모
- 상수 `REPEAT_MAX_END_DATE = '2025-12-31'` 가정. 단위 테스트는 함수 관점에서 결과만 검증한다.
- 통합 테스트는 뷰 이동 방법과 셀렉터를 기존 테스트 패턴에 맞춰 최소 변경으로 재사용한다.
