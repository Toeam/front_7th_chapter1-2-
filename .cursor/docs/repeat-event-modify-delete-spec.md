# 반복 일정 수정/삭제 명세서

## 📋 개요
- 우측 일정 목록에서 수정/삭제 액션 수행 시, 반복 일정의 단일 인스턴스만 대상으로 할지 또는 전체 반복 시리즈에 적용할지 선택 가능한 플로우를 제공한다.
- 목적: 사용자가 반복 일정에 대해 개별 인스턴스 보정(수정/삭제) 또는 전체 시리즈 일괄 변경/삭제를 명확히 선택할 수 있게 한다.

## 🎯 요구사항
### 기능 요구사항
- [ ] 우측 일정 목록의 수정 아이콘 클릭 시 좌측에 수정 폼이 표시되어야 한다.
- [ ] 수정 폼 하단의 저장(일정 수정) 시, "단일 수정 vs 전체 수정" 선택 모달을 표시해야 한다.
  - [ ] "예" 선택 시: 현재 인스턴스(해당 날짜)만 단일 수정 처리
    - [ ] 반복 일정이 단일 일정으로 분리 생성된다(해당 인스턴스만 독립 이벤트로 저장).
    - [ ] 원본 반복 시리즈에서는 해당 날짜 인스턴스가 표시되지 않아야 한다(예외 처리).
    - [ ] 단일로 분리된 이벤트에는 반복 아이콘이 표시되지 않는다.
  - [ ] "아니오" 선택 시: 전체 시리즈 수정 처리
    - [ ] 원본 반복 이벤트의 속성(title/time/description 등)을 일괄 갱신한다.
    - [ ] 반복 속성은 유지되며 반복 아이콘도 유지된다.
- [ ] 우측 일정 목록의 삭제 아이콘 클릭 시, "단일 삭제 vs 전체 삭제" 선택 모달을 표시해야 한다.
  - [ ] "예" 선택 시: 현재 인스턴스(해당 날짜)만 삭제 처리 → 원본 시리즈에서 해당 날짜 인스턴스를 예외로 등록하여 표시되지 않게 한다.
  - [ ] "아니오" 선택 시: 전체 시리즈 삭제 처리 → 원본 반복 이벤트 삭제.

### 비기능 요구사항
- 성능: 인스턴스 확장과 예외 처리로 인한 렌더링 비용이 월/주 뷰에서 체감되지 않을 것(현 데이터 규모 기준).
- 접근성: 모달은 키보드 내비게이션으로 조작 가능해야 하며, 버튼 레이블은 시맨틱하게 구분 가능해야 한다.
- 사용성: 선택 모달에서 선택 취소 시 아무 변경도 발생하지 않는다.

## 📊 입력값 및 예시
### 입력(핵심 구조)
```typescript
// src/types.ts
export type RepeatType = 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly';

export interface RepeatInfo {
  type: RepeatType;
  interval: number;
  endDate?: string; // ISO YYYY-MM-DD
}

export interface EventForm {
  title: string;
  date: string; // ISO YYYY-MM-DD (기준 시작일 또는 단일 일정일)
  startTime: string; // HH:mm
  endTime: string;   // HH:mm
  description: string;
  location: string;
  category: string;
  repeat: RepeatInfo; // 단일 일정은 { type: 'none', interval: 0 }
  notificationTime: number; // 분 단위
}

export interface Event extends EventForm {
  id: string;
  // 제안: 반복 시리즈에서 특정 occurrence를 숨기기 위한 예외일 목록(ISO 날짜)
  // 단일 일정에서는 사용하지 않음
  exceptions?: string[];
}
```

### 출력(동작 결과 예시)
```typescript
// 단일 수정(예 선택) 처리 예시
// 1) 원본 반복 이벤트(eSeries)에 exceptions에 해당 날짜 추가
// eSeries.exceptions = [...(eSeries.exceptions ?? []), '2025-10-15']
// 2) 단일 이벤트로 신규 생성(eSingle)
// eSingle.repeat = { type: 'none', interval: 0 }
// eSingle.date = '2025-10-15'
// → 렌더링 결과: 해당 날짜에는 eSingle만 표시, 반복 아이콘 없음

// 전체 수정(아니오 선택) 처리 예시
// 원본 반복 이벤트 eSeries의 필드(title, time 등) 일괄 갱신
// eSeries.repeat 유지 → 모든 발생 인스턴스에 변경 반영, 반복 아이콘 유지

// 단일 삭제(예 선택) 처리 예시
// eSeries.exceptions에 '2025-10-15' 추가 → 해당 날짜 인스턴스 미표시

// 전체 삭제(아니오 선택) 처리 예시
// eSeries 자체 삭제 → 모든 인스턴스 제거
```

## 🔗 영향받는 부분
- 영향받는 컴포넌트/훅/유틸
  - `src/hooks/useEventOperations.ts`: 저장/삭제 로직에 단일/전체 분기 추가, 예외 등록 및 단일 분리 생성 흐름 포함
  - `src/utils/eventUtils.ts`: 인스턴스 확장 시 `exceptions` 날짜는 스킵하도록 확장 로직 보강 필요
  - `src/types.ts`: `Event`에 `exceptions?: string[]` 필드 추가(선언적 예외 모델)
  - 통합 뷰/리스트 컴포넌트: 반복 아이콘 표시 조건은 `event.repeat.type !== 'none'` 유지
- 수정이 필요한 파일
  - `src/types.ts` (필드 추가)
  - `src/utils/eventUtils.ts` (예외 스킵 로직)
  - `src/hooks/useEventOperations.ts` (단일/전체 처리 분기 + 모달 응답 반영)
- 새로운 파일/디렉토리
  - 없음(기존 구조 내 확장)

## 시나리오
- 단일 수정(예)
  1) 우측 목록에서 반복 이벤트 A(시작일 2025-10-15)를 수정 아이콘 클릭
  2) 좌측 수정 폼에서 제목/시간 변경
  3) 저장 클릭 → 선택 모달 표시
  4) "예" 선택 → 원본 A에 exceptions += ['2025-10-15']; 단일 이벤트 A' 신규 생성(반복 없음)
  5) 목록/달력에는 2025-10-15에 A'만 표시(반복 아이콘 없음), 이후 반복 인스턴스는 기존 규칙대로 표시

- 전체 수정(아니오)
  1) 동일 초기 단계
  2) 저장 클릭 → 선택 모달에서 "아니오"
  3) 원본 반복 이벤트 A의 필드 일괄 갱신(반복 규칙 유지)
  4) 목록/달력에서 해당 시점 전후 인스턴스가 수정된 내용으로 반영

- 단일 삭제(예)
  1) 우측 목록에서 삭제 아이콘 클릭
  2) 선택 모달에서 "예"
  3) 원본 반복 이벤트 A.exceptions += ['2025-10-15'] → 해당 날짜 인스턴스 미표시

- 전체 삭제(아니오)
  1) 우측 목록에서 삭제 아이콘 클릭
  2) 선택 모달에서 "아니오"
  3) 원본 반복 이벤트 A 삭제 → 모든 인스턴스 제거

## 예외 케이스/경계값
- exceptions 중복 추가 방지: 동일 날짜가 중복 등록되지 않도록 처리
- endDate가 존재하는 시리즈에서 exceptions가 endDate 이후 값을 포함하지 않도록 입력 검증(선택)
- 단일 수정 후 단일 이벤트가 기존 다른 이벤트와 겹쳐도, 기존 명세에 따라 겹침 경고 정책을 따름(반복 여부와 무관)
- 모달 취소 시: 아무 변경 없음(서버/상태 미변경)

## ✅ 체크리스트
- [ ] 단일/전체 분기 모달을 통해 수정 저장 흐름이 제어된다
- [ ] 단일 수정 시 해당 날짜 인스턴스는 원본 시리즈에서 숨겨지고, 단일 이벤트로 표시된다
- [ ] 전체 수정 시 반복 규칙과 아이콘은 유지된다
- [ ] 단일 삭제 시 해당 날짜만 숨겨진다
- [ ] 전체 삭제 시 시리즈가 제거된다
- [ ] 월/주 뷰 확장 시 `exceptions`가 적용되어 인스턴스가 스킵된다
- [ ] 반복 아이콘 표시 조건: `repeat.type !== 'none'`
- [ ] 접근성: 모달 버튼은 접근성 쿼리로 식별 가능해야 한다

## 🧪 테스트 가이드(설계 참고)
- 통합 테스트(`__tests__/medium.repeat.integration.spec.tsx`)에 시나리오 추가 권장
  - 단일 수정 → 아이콘 제거 확인 및 동일 날짜 시리즈 인스턴스 미표시
  - 전체 수정 → 아이콘 유지 및 모든 인스턴스 필드 갱신 확인
  - 단일 삭제 → 해당 날짜만 미표시
  - 전체 삭제 → 모든 인스턴스 제거
- 유틸 단위 테스트(`__tests__/unit/medium.repeatUtils.spec.ts` 또는 기존 `eventUtils` 기반)에서 `exceptions` 스킵 동작 검증

