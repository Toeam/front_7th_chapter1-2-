# 반복 유형 선택 기능 명세서

## 📋 개요
- 목적: 일정 생성/수정 시 반복 유형(매일/매주/매월/매년)을 선택할 수 있도록 하여 반복 일정을 자동으로 확장/표시한다.
- 범위: UI 선택(반복 여부/유형/간격/종료일), 일정 목록/주/월 뷰에서 반복 일정의 노출, 저장 시 겹침 처리 정책.
- 기대 효과: 반복 일정 관리 효율성 향상, 경계일(매월 31일/2월 29일) 동작의 명확화.

## 🎯 요구사항
### 기능 요구사항
- [ ] 일정 생성/수정 시 반복 여부 토글과 반복 유형(매일/매주/매월/매년)을 선택할 수 있다.
- [ ] 반복 간격(기본 1)과 반복 종료일(선택)을 설정할 수 있다.
- [ ] 반복 유형에 따라 주/월 뷰와 검색 결과에 반복 인스턴스가 표시된다.
- [ ] 반복 일정은 저장 시 기존 일정과의 겹침 여부를 검사하지 않는다.
- [ ] "매월"에서 31일은 매월 31일에만 생성되며, 마지막 날 대체 생성은 하지 않는다.
- [ ] "매년"에서 윤년 2월 29일은 다음 윤년의 2월 29일에만 생성된다.

### 비기능 요구사항
- 성능: 월 뷰 확장에서 한 달 범위 내 계산은 O(N) 수준(이벤트 수 N)에 머문다.
- 접근성: 선택 컴포넌트에 라벨 제공, 폼 요소는 키보드 접근 가능.
- 사용성: 기본 간격 1, 종료일은 선택 사항, 오류 메시지는 현행 규칙에 맞춘다.

## 📊 입력값 및 예시
### 입력 (EventForm)
```typescript
interface RepeatInfo { type: 'none'|'daily'|'weekly'|'monthly'|'yearly'; interval: number; endDate?: string }
interface EventForm {
  title: string; date: string; startTime: string; endTime: string;
  description: string; location: string; category: string;
  repeat: RepeatInfo; notificationTime: number;
}
```

예시 1: 매월 31일 반복
```typescript
repeat: { type: 'monthly', interval: 1, endDate: '2026-12-31' }
// 시작일: '2025-01-31' → 2025-02,04,06,09,11에는 표시되지 않음. 02월 대체 마지막 날 생성 금지.
```

예시 2: 매년 윤년 2월 29일 반복
```typescript
repeat: { type: 'yearly', interval: 1 }
// 시작일: '2024-02-29' → 2028-02-29, 2032-02-29 ... 에만 표시.
```

예시 3: 매주 수요일 기준, 2주 간격
```typescript
start: '2025-10-01' (수) repeat: { type: 'weekly', interval: 2 }
// 2주 간격으로 같은 요일에 표시.
```

## 🔗 영향받는 부분
- 영향받는 컴포넌트/훅/유틸
  - `src/App.tsx`: 반복 UI 노출/저장 시 겹침 검사 우회 로직
  - `src/hooks/useEventForm.ts`: 반복 관련 상태(유형/간격/종료일) 유지
  - `src/utils/eventUtils.ts`: `getFilteredEvents`에서 반복 인스턴스 확장 처리 추가
  - `src/types.ts`: 반복 타입 이미 있음(확인 완료)
- 수정이 필요한 파일
  - `src/App.tsx`, `src/utils/eventUtils.ts`
- 새로운 파일/디렉토리
  - 필요 시 `src/utils/repeatUtils.ts` 등으로 반복 확장 로직 분리 가능

## ✅ 체크리스트
- [ ] 명세 완료(본 문서)
- [ ] 영향 범위 파악 완료
- [ ] 개발자 리뷰 완료
- 🧪 테스트 케이스
  - [ ] 매일/매주/매월/매년 기본 확장 표시
  - [ ] 매월 31일: 31일에만 생성, 말일 대체 금지
  - [ ] 매년 2월 29일: 윤년에만 생성
  - [ ] 종료일 초과 미표시, 간격 반영
  - [ ] 반복 일정 저장 시 겹침 무시

## 시나리오
1) 사용자가 "반복 일정" 체크 → 반복 유형을 "매월", 간격 1, 시작일 2025-01-31 설정 → 월 뷰에서 2025-02에는 표시되지 않음, 2025-03-31에는 표시.
2) 사용자가 2024-02-29에 "매년" 반복 생성 → 2025-02에는 미표시, 2028-02-29에 표시.
3) 사용자가 겹치는 시간대에 반복 일정을 생성 → 저장 시 겹침 경고/차단 없음.
